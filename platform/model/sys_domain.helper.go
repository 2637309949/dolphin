// Code generated by dol build. DO NOT EDIT.
// source: auto.go

package model

import (
	"fmt"
	"strings"
	"time"

	"github.com/2637309949/dolphin/platform/util"
	"github.com/spf13/viper"

	"github.com/2637309949/dolphin/packages/null"
	"github.com/2637309949/dolphin/packages/xormplus/xorm"
)

// Ensure defined inital system data
func (m *SysDomain) Ensure(db *xorm.Engine) {
	if !util.EnsureLeft(db.IsTableExist(new(SysDomain))).(bool) {
		db.Sync2(new(SysDomain))
	}
}

// CreateDataBase defined
func (m *SysDomain) CreateDataBase(db *xorm.Engine, driverName, database string) error {
	if driverName != "sqlite3" {
		_, err := db.SQL(fmt.Sprintf("create database if not exists %v default character set utf8mb4 default collate utf8mb4_general_ci", database)).Execute()
		if err != nil {
			return err
		}
	}
	return nil
}

// InitSysData defined inital system data
func (m *SysDomain) InitSysData(s *xorm.Engine) error {
	domains := []SysDomain{
		{
			ID:         null.IntFrom(1),
			Name:       null.StringFrom("localhost"),
			FullName:   null.StringFrom("localhost"),
			AppName:    null.StringFrom(viper.GetString("app.name")),
			Theme:      null.StringFrom("default"),
			DriverName: null.StringFrom(viper.GetString("db.driver")),
			LoginUrl:   null.StringFrom("localhost"),
			Type:       null.IntFrom(0),
			Status:     null.IntFrom(1),
			IsSync:     null.IntFrom(0),
			AuthMode:   null.IntFrom(1),
			Domain:     null.StringFrom("localhost"),
			DomainUrl:  null.StringFrom("localhost"),
			ApiUrl:     null.StringFrom("http://localhost:8082"),
			Creater:    null.IntFrom(1),
			CreateTime: null.TimeFrom(time.Now()),
			Updater:    null.IntFrom(1),
			UpdateTime: null.TimeFrom(time.Now()),
			IsDelete:   null.IntFrom(0),
		},
	}
	for i := range domains {
		occ, occLoc := "?", "_localhost?"
		if ct, err := s.Where("id=?", domains[i].ID.Int64).Count(new(SysDomain)); ct == 0 || err != nil {
			if err != nil {
				return err
			}
			if domains[i].DriverName.String == "sqlite3" {
				occ = ".db"
				occLoc = "_localhost.db"
			}
			domains[i].DataSource = null.StringFrom(strings.Replace(viper.GetString("db.dataSource"), occ, occLoc, 1))
			if _, err := s.Insert(&domains[i]); err != nil {
				return err
			}
		}
	}
	return nil
}
