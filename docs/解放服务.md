### Knative
Knative组件构建于Kubernetes之上，抽象出复杂的细节，使开发人员能够专注于重要的事情。 通过编写来自现实世界成功实现的最佳实践，Knative解决了构建、部署和管理云原生服务的“无聊但困难”的部分，从而得以解脱。

1. 安装K3S
```shell
export chifun=https://github.91chifun.workers.dev
wget ${chifun}/https://github.com//k3s-io/k3s/releases/download/v1.21.2%2Bk3s1/k3s-airgap-images-amd64.tar  
wget ${chifun}/https://github.com//k3s-io/k3s/releases/download/v1.21.2%2Bk3s1/k3s  
sudo mkdir -p /var/lib/rancher/k3s/agent/images/
sudo cp ./k3s /usr/local/bin/
sudo cp ./k3s-airgap-images-amd64.tar /var/lib/rancher/k3s/agent/images/
sudo chmod +x /usr/local/bin/k3s
curl -sfL https://get.k3s.io | INSTALL_K3S_SKIP_DOWNLOAD=true \
  K3S_KUBECONFIG_MODE=644 sh -
cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
```

2. 安装Knative

安装istio
```shell
kubectl apply -l knative.dev/crd-install=true -f \
  https://github.com/knative/net-istio/releases/download/v0.24.0/istio.yaml
kubectl apply -f https://github.com/knative/net-istio/releases/download/v0.24.0/istio.yaml
```

安装serving
```shell
kubectl apply -f https://github.com/knative/serving/releases/download/v0.24.0/serving-crds.yaml
kubectl apply -f https://github.com/knative/serving/releases/download/v0.24.0/serving-core.yaml
kubectl apply -f https://github.com/knative/net-istio/releases/download/v0.24.0/net-istio.yaml
```

安装eventing
```shell
kubectl apply -f https://github.com/knative/eventing/releases/download/v0.24.0/eventing-crds.yaml
kubectl apply -f https://github.com/knative/eventing/releases/download/v0.24.0/eventing-core.yaml
kubectl apply -f https://github.com/knative/eventing/releases/download/v0.24.0/in-memory-channel.yaml
```

国外的镜像可以通过dockerlab提交到自己的docker.io仓库  
```shell
docker pull xxx
docker tag xxx xx/knative-cmd-webhook
docker push xx/knative-cmd-webhook
```

3. helloworld

```yaml
apiVersion: serving.knative.dev/v1 # Current version of Knative
kind: Service
metadata:
  name: helloworld # The name of the app
  namespace: default # The namespace the app will use
spec:
  template:
    spec:
      containers:
        - image: crccheck/hello-world # Reference to the image of the app
          env:
            - name: TARGET # The environment variable printed out by the sample app
              value: "Web Sample v1"
```

```shell
$ kubectl get ksvc
NAME            URL                                        LATESTCREATED         LATESTREADY        READY     REASON
helloworld-go   http://helloworld-go.default.example.com   helloworld-go-00001   helloworld-go-00001   True    
```

测试访问：
```shell
curl -HHost:helloworld-go.default.example.com http://172.16.10.191:31212 
Hello Go Sample v1!
```
