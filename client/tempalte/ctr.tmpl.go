// Copyright (c) 2018-2020 Double All rights reserved.
// Use of this source code is governed by a MIT style
// license that can be found in the LICENSE file.

package tempalte

// TmplCtr defined template
var TmplCtr = `// Code generated by dol build. Only Generate by tools if not existed.
// source: {{.Controller.Name}}.go

package app

import (
	"{{.PackageName}}/model"
	"{{.PackageName}}/utils"
	"net/http"

	"github.com/gin-gonic/gin/binding"
)

// {{.Controller.ToUpperCase .Controller.Name}} struct
type {{.Controller.ToUpperCase .Controller.Name}} struct {
	*Engine
}

// Build{{.Controller.ToUpperCase .Controller.Name}} return {{.Controller.ToUpperCase .Controller.Name}}
func Build{{.Controller.ToUpperCase .Controller.Name}}(build func(*{{.Controller.ToUpperCase .Controller.Name}})) func(engine *Engine) {
	return func(engine *Engine) {
		build(&{{.Controller.ToUpperCase .Controller.Name}}{Engine: engine})
	}
}

{{range .Controller.APIS}}
// {{.ToUpperCase .Name}} {{.ToUpperCase .Desc}}
// @Title {{.ToUpperCase .Name}}
// @Description {{.ToUpperCase .Desc}}
{{- range .Params}}
// @Param	{{.Name}}      {{.Type}}  {{.Desc}}
{{- end}}
// @Success 200 {object} Account
// @Failure 403 :id is empty
// @Router /api{{.Version}}/{{$.Controller.Name}}/{{.Name}} [{{.Method}}]
func (ctr *{{$.Controller.ToUpperCase $.Controller.Name}}) {{.ToUpperCase .Name}}(ctx *Context) {
	var form = &struct{}{}
	if err := ctx.ShouldBindBodyWith(form, binding.JSON); err != nil {
		ctx.JSON(http.StatusInternalServerError, utils.M{"code": 500, "message": err.Error()})
		return
	}
	ret, err := utils.AppAction(form)
	if err != nil {
		code := 500
		if err, ok := err.(utils.Error); ok {
			code = err.Code
		}
		ctx.JSON(http.StatusInternalServerError, utils.M{"code": code, "message": err.Error()})
		return
	}
	ctx.JSON(http.StatusOK, ret)
}
{{end}}
`
